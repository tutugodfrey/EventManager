{"version":3,"sources":["../../src/controllers/notificationsController.js"],"names":["notifications","users","Notifications","req","res","userType","body","userId","parseInt","console","log","message","find","where","id","then","user","create","status","send","created","catch","error","params","findAll","allNotifications","all"],"mappings":"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","file":"notificationsController.js","sourcesContent":["import models from './../models';\r\n\r\nconst { notifications, users } = models;\r\nconst Notifications = class {\r\n  /* eslint-disable class-methods-use-this */\r\n  // to post notification to db table as well send an email\r\n  createNotification(req, res) {\r\n    const { userType } = req.body;\r\n    if (userType === 'admin') {\r\n      const userId = parseInt(req.body.userId, 10);\r\n      console.log(userId);\r\n      const { message } = req.body;\r\n      return users\r\n        .find({\r\n          where: {\r\n            id: userId,\r\n            userType: 'regular',\r\n          },\r\n        })\r\n        .then((user) => {\r\n          if (user) {\r\n            return notifications\r\n              .create({\r\n                message,\r\n                userId,\r\n              })\r\n              .then(created => res.status(201).send(created))\r\n              .catch(error => res.status(500).send(error));\r\n          }\r\n          return res.status(404).send({ message: 'User not found' });\r\n        })\r\n        .catch(error => res.status(500).send(error));\r\n    }\r\n    return res.status(402).send({ message: 'Your are not allowed to perform this action' });\r\n  }\r\n\r\n  getNotifications(req, res) {\r\n    const userId = parseInt(req.params.userId, 10);\r\n    return users\r\n      .find({\r\n        where: {\r\n          id: userId,\r\n        },\r\n      })\r\n      .then((user) => {\r\n        if (user) {\r\n          return notifications\r\n            .findAll({\r\n              where: {\r\n                userId,\r\n              },\r\n            })\r\n            .then(allNotifications => res.status(200).send(allNotifications))\r\n            .catch((error) => {\r\n              res.status(404).send({\r\n                error,\r\n                message: 'No new notification',\r\n              });\r\n            });\r\n        }\r\n        return res.status(404).send({ message: 'Not a registered user' });\r\n      })\r\n      .catch(error => res.status(500).send(error));\r\n  }\r\n  // get all notification\r\n  getAllNotifications(req, res) {\r\n    return notifications\r\n      .all()\r\n      .then(allNotifications => res.status(200).send(allNotifications))\r\n      .catch((error) => {\r\n        res.status(404).send({\r\n          error,\r\n          message: 'No new notification',\r\n        });\r\n      });\r\n  }\r\n};\r\nexport default Notifications;\r\n"]}