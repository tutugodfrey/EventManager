{"version":3,"sources":["../../src/test/testApi.js"],"names":["users","events","centers","notifications","server","expect","app","expressServer","use","adminUser","regularUser","signedInUser","eventCenter","event","describe","before","sync","force","then","catch","error","it","request","get","res","body","to","be","an","post","set","field","attach","Object","assign","have","status","send","username","password","token","userType","userId","updateCenter","centerName","location","cost","sits","facilities","put","id","updateEvent","eventType","centerId","notification","message"],"mappings":"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","file":"testApi.js","sourcesContent":["import chai from 'chai';\r\nimport chaiHttp from 'chai-http';\r\nimport Server from './../app';\r\nimport models from './../models/index';\r\n\r\nconst {\r\n  users,\r\n  events,\r\n  centers,\r\n  notifications,\r\n} = models;\r\nconst server = new Server();\r\nconst { expect } = chai;\r\nconst app = server.expressServer();\r\nchai.use(chaiHttp);\r\n\r\nconst adminUser = {};\r\nconst regularUser = {};\r\nconst signedInUser = {};\r\nconst eventCenter = {};\r\nconst event = {};\r\n\r\ndescribe('API routes', () => {\r\n  before('clear database', () => {\r\n    return centers.sync({ force: true })\r\n      .then(() => {\r\n        return notifications.sync({ force: true });\r\n      })\r\n      .then(() => {\r\n        return users.sync({ force: true });\r\n      })\r\n      .then(() => {\r\n        return events.sync({ force: true });\r\n      })\r\n      .catch((error) => {\r\n        throw error;\r\n      });\r\n  });\r\n\r\n  // test default route\r\n  describe('Home', () => {\r\n    it('should return welcome message', () => {\r\n      return chai.request(app)\r\n        .get('/')\r\n        .then((res) => {\r\n          expect(res.body).to.be.an('Object');\r\n        });\r\n    });\r\n  });\r\n\r\n  describe('Admin User', () => {\r\n    it('should create new admin user', () => {\r\n      return chai.request(app)\r\n        .post('/users/signup')\r\n        .set('Content-Type', 'multipart/form-data')\r\n        .field('fullname', 'tutu godfrey')\r\n        .field('username', 'tutug')\r\n        .field('email', 'meandyou@yahoo.com')\r\n        .field('gender', 'male')\r\n        .field('passwd1', '12345')\r\n        .field('passwd2', '12345')\r\n        .field('userType', 'admin')\r\n        .field('securityQtn', 'what isthe name of your best teacher?')\r\n        .field('securityAns', 'westle')\r\n      // .send(user)\r\n        .attach('userPix', 'C:/Users/TUTU GODFREY/Desktop/pic/wp_ss_20150407_0001.png')\r\n        .then((res) => {\r\n          Object.assign(adminUser, res.body);\r\n          expect(res).to.have.status(201);\r\n          expect(res.body).to.be.an('Object');\r\n        });\r\n    });\r\n\r\n    it('should signin a adminUser in and give a token', () => {\r\n      return chai.request(app)\r\n        .post('/users/signin')\r\n        .send({\r\n          username: adminUser.username,\r\n          password: '12345',\r\n        })\r\n        .then((res) => {\r\n          Object.assign(signedInUser, res.body);\r\n          expect(res).to.have.status(200);\r\n          expect(res.body).to.be.an('Object');\r\n        });\r\n    });\r\n\r\n    it('should create event Center', () => {\r\n      return chai.request(app)\r\n        .post('/api/centers')\r\n        .set('Content-Type', 'multipart/form-data')\r\n        .set('token', signedInUser.token)\r\n        .field('userType', signedInUser.userType)\r\n        .field('centerName', 'gard park')\r\n        .field('location', 'Abuja')\r\n        .field('cost', 240)\r\n        .field('sits', 500)\r\n        .field('facilities', 'Air condition')\r\n        .field('userId', signedInUser.userId)\r\n        .field('facilities', 'projector')\r\n        .attach('centerPix', 'C:/Users/TUTU GODFREY/Desktop/pic/wp_ss_20150309_0001.png')\r\n        .then((res) => {\r\n          Object.assign(eventCenter, res.body);\r\n          expect(res).to.have.status(201);\r\n          expect(res.body).to.be.an('object');\r\n        });\r\n    });\r\n\r\n    it('should update an event Center', () => {\r\n      const updateCenter = {\r\n        userType: signedInUser.userType,\r\n        centerName: 'gard park',\r\n        location: 'Abuja',\r\n        cost: 120,\r\n        sits: 520,\r\n        facilities: ['Air condition', 'Catering'],\r\n        userId: signedInUser.userId,\r\n      };\r\n      return chai.request(app)\r\n        .put(`/api/centers/${eventCenter.id}`)\r\n        .set('token', signedInUser.token)\r\n        .send(updateCenter)\r\n        .then((res) => {\r\n          expect(res).to.have.status(201);\r\n          expect(res.body).to.be.an('object');\r\n        });\r\n    });\r\n  }); // end admin section\r\n  describe('regular Users', () => {\r\n    it('should create new regular user', () => {\r\n      return chai.request(app)\r\n        .post('/users/signup')\r\n        .set('Content-Type', 'multipart/form-data')\r\n        .field('fullname', 'tut godfrey')\r\n        .field('username', 'gtutu')\r\n        .field('email', 'allofus@yahoo.com')\r\n        .field('gender', 'male')\r\n        .field('passwd1', '12345')\r\n        .field('passwd2', '12345')\r\n        .field('userType', 'regular')\r\n        .field('securityQtn', 'what isthe name of your best teacher?')\r\n        .field('securityAns', 'westle')\r\n        .attach('userPix', 'C:/Users/TUTU GODFREY/Desktop/pic/wp_ss_20140715_0001.png')\r\n        .then((res) => {\r\n          Object.assign(regularUser, res.body);\r\n          expect(res).to.have.status(201);\r\n          expect(res.body).to.be.an('Object');\r\n        });\r\n    });\r\n\r\n    it('should signin a regularUser in and give a token', () => {\r\n      return chai.request(app)\r\n        .post('/users/signin')\r\n        .send({\r\n          username: 'gtutu',\r\n          password: '12345',\r\n        })\r\n        .then((res) => {\r\n          Object.assign(signedInUser, res.body);\r\n          expect(res).to.have.status(200);\r\n          expect(res.body).to.be.an('Object');\r\n        });\r\n    });\r\n\r\n    it('should create event', () => {\r\n      return chai.request(app)\r\n        .post('/api/events')\r\n        .set('Content-Type', 'multipart/form-data')\r\n        .set('token', signedInUser.token)\r\n        .field('eventType', 'wedding')\r\n        .field('eventDate', '2018-02-10')\r\n        .field('facilities', eventCenter.facilities[0])\r\n        .field('facilities', eventCenter.facilities[1])\r\n        .field('centerId', eventCenter.id)\r\n        .field('userId', signedInUser.userId)\r\n        .attach('eventPix', 'C:/Users/TUTU GODFREY/Desktop/pic/wp_ss_20150922_0001.png')\r\n        .then((res) => {\r\n          Object.assign(event, res.body);\r\n          expect(res).to.have.status(201);\r\n          expect(res.body).to.be.an('object');\r\n        });\r\n    });\r\n\r\n    it('should update an event', () => {\r\n      const updateEvent = {\r\n        eventType: 'wedding anniversar',\r\n        centerId: event.centerId,\r\n        userId: signedInUser.userId,\r\n      };\r\n      return chai.request(app)\r\n        .put(`/api/events/${event.id}`)\r\n        .set('token', signedInUser.token)\r\n        .send(updateEvent)\r\n        .then((res) => {\r\n          expect(res).to.have.status(201);\r\n          expect(res.body).to.be.an('object');\r\n        });\r\n    });\r\n  }); // end reuglar user\r\n  describe('Notifications', () => {\r\n    it('should signin a adminUser in and give a token', () => {\r\n      return chai.request(app)\r\n        .post('/users/signin')\r\n        .send({\r\n          username: adminUser.username,\r\n          password: '12345',\r\n        })\r\n        .then((res) => {\r\n          Object.assign(signedInUser, res.body);\r\n          expect(res).to.have.status(200);\r\n          expect(res.body).to.be.an('Object');\r\n        });\r\n    });\r\n\r\n    it('Create new notification', () => {\r\n      const notification = {\r\n        message: 'your events is cancelled',\r\n        userType: signedInUser.userType,\r\n        userId: regularUser.id,\r\n      };\r\n      return chai.request(app)\r\n        .post('/api/notifications')\r\n        .set('token', signedInUser.token)\r\n        .send(notification)\r\n        .then((res) => {\r\n          expect(res).to.have.status(201);\r\n        });\r\n    });\r\n\r\n    it('Get notification', () => {\r\n      return chai.request(app)\r\n        .get(`/api/notifications/${regularUser.id}`)\r\n        .set('token', signedInUser.token)\r\n        .then((res) => {\r\n          expect(res).to.have.status(200);\r\n        });\r\n    });\r\n  }); // end notification\r\n});\r\n\r\n"]}